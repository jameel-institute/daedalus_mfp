location == "HIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"))) +
theme(panel.spacing = unit(0.75, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
guides(color = guide_legend(title = NULL, override.aes = list(linewidth = 1.5)), fill = "none", alpha = "none") +
theme(legend.position = "bottom", legend.box.just = "right",
legend.key.size = unit(0.8, "cm"), legend.text = element_text(size = 9),
legend.margin = margin(0, 0, 0, 0))
gg <- ggdraw(gg) + draw_text(evppi_labs$xlabel, x = evppi_labs$xx, y = evppi_labs$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_S9.png", plot = gg, height = 14, width = 10)
seq(0.0470, 0.84, by = 0.1318)
seq(0.0470, 0.84, by = 0.1317)
evppi_labs   <- evppi_fits %>%
group_by(disease, location) %>%
summarize(xlabel = unique(parameter), .groups = "drop") %>% #may vary by income group(@)
mutate(xlabel = case_when(xlabel == "mean_age" ~ "Average Age (years)",
#xlabel == "pr_le" ~ "@ Life Expectancy (years)",
#xlabel == "AL_wavg" ~ "Household Contacts (#/person/day)",
#xlabel == "AHT_wavg" ~ "Other-Location Contacts (#/person/day)",
xlabel == "AS_wavg" ~ "School Contacts (#/child/day)",
#xlabel == "workp" ~ "Workplace Contacts (#/adult/day)",
#xlabel == "epop" ~ "Employment-Population Ratio (%)",
#xlabel == "pr_workf" ~ "@ Sector Workforce (%)",
xlabel == "pr_gvapw" ~ "GVA per Worker ($)",
#xlabel == "pr_wfh" ~ "@ Home-Working Ratio (%)",
xlabel == "Tres" ~ "Response Time (doubling times)",
xlabel == "sda" ~ "Distancing Multiplier Intercept",
xlabel == "sdb" ~ "Distancing Death-Sensitivity",
xlabel == "sdc" ~ "Distancing Time-Decay",
xlabel == "t_tit" ~ "Testing Start-Time (doubling times)",
xlabel == "trate" ~ "Testing Rate (per 100k/day)",
xlabel == "Hmax" ~ "Spare Hospital Beds (per 100k)",
xlabel == "t_vax" ~ "Vaccination Start-Time (days)",
#xlabel == "arate" ~ "Vaccination Rate (per 100k/day)",
xlabel == "puptake" ~ "Vaccination Coverage (% of HIT)"),
xx = rep(c(0.17, 0.49, 0.81), 7),
xy = rep(seq(0.8372, 0.01, by = -0.1317), each = 3))
gg <- ggplot(output_data, aes(x = xaxis, y = SLpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = evppi_fits,
aes(ymin = lower, ymax = upper, fill = strategy, alpha = ceiling(alpha)*(0.05+0.45*(res > 0.25))),
color = NA) +
geom_point(shape = 19, size = 0.02, stroke = 0.2) +
geom_line(data = evppi_fits, linewidth = 0.5) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0, 1)) +
theme_bw() +
facetted_pos_scales(
x = list(
location == "LLMIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(1,300),breaks=c(1,3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(3,300),breaks=c(3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(10,1000),breaks=c(10,30,100,300,1000),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-3,3),breaks=seq(-3,3,by=1.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Influenza-1918-X" ~ scale_x_log10(limits=c(1,300),breaks=c(1,3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-1918-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-1918-X" ~ scale_x_continuous(limits=c(50,200),breaks=seq(50,200,by=50),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Omicron-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Omicron-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Omicron-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Delta-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Delta-X" ~ scale_x_log10(limits=c(1e-3,1e-1),breaks=c(1e-3,3e-3,1e-2,3e-2,1e-1),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Delta-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Wildtype-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Wildtype-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Wildtype-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "SARS-X" ~ scale_x_continuous(limits=c(0,250),breaks=seq(0,250,by=50),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "SARS-X" ~ scale_x_log10(limits=c(1,100),breaks=c(1,3,10,30,100),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "SARS-X" ~ scale_x_continuous(limits=c(4,14),breaks=seq(4,14,by=2),expand=c(0,0),position="bottom")),
y = list(
location == "LLMIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"))) +
theme(panel.spacing = unit(0.75, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
guides(color = guide_legend(title = NULL, override.aes = list(linewidth = 1.5)), fill = "none", alpha = "none") +
theme(legend.position = "bottom", legend.box.just = "right",
legend.key.size = unit(0.8, "cm"), legend.text = element_text(size = 9),
legend.margin = margin(0, 0, 0, 0))
gg <- ggdraw(gg) + draw_text(evppi_labs$xlabel, x = evppi_labs$xx, y = evppi_labs$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_S9.png", plot = gg, height = 14, width = 10)
output_data  <- output_data %>%
filter(!(location == "LLMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "UMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "School Closures") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "Elimination") &
!(location == "HIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures"))
#                        !(location == "HIC" & disease == "Covid-Wildtype-X" & strategy == "No Closures"))
evppi_fits   <- evppi_fits %>%
filter(!(location == "LLMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "UMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "School Closures") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "Elimination") &
!(location == "HIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures"))
#                        !(location == "HIC" & disease == "Covid-Wildtype-X" & strategy == "No Closures"))
evppi_labs   <- evppi_fits %>%
group_by(disease, location) %>%
summarize(xlabel = unique(parameter), .groups = "drop") %>% #may vary by income group(@)
mutate(xlabel = case_when(xlabel == "mean_age" ~ "Average Age (years)",
#xlabel == "pr_le" ~ "@ Life Expectancy (years)",
#xlabel == "AL_wavg" ~ "Household Contacts (#/person/day)",
#xlabel == "AHT_wavg" ~ "Other-Location Contacts (#/person/day)",
xlabel == "AS_wavg" ~ "School Contacts (#/child/day)",
#xlabel == "workp" ~ "Workplace Contacts (#/adult/day)",
#xlabel == "epop" ~ "Employment-Population Ratio (%)",
#xlabel == "pr_workf" ~ "@ Sector Workforce (%)",
xlabel == "pr_gvapw" ~ "GVA per Worker ($)",
#xlabel == "pr_wfh" ~ "@ Home-Working Ratio (%)",
xlabel == "Tres" ~ "Response Time (doubling times)",
xlabel == "sda" ~ "Distancing Multiplier Intercept",
xlabel == "sdb" ~ "Distancing Death-Sensitivity",
xlabel == "sdc" ~ "Distancing Time-Decay",
xlabel == "t_tit" ~ "Testing Start-Time (doubling times)",
xlabel == "trate" ~ "Testing Rate (per 100k/day)",
xlabel == "Hmax" ~ "Spare Hospital Beds (per 100k)",
xlabel == "t_vax" ~ "Vaccination Start-Time (days)",
#xlabel == "arate" ~ "Vaccination Rate (per 100k/day)",
xlabel == "puptake" ~ "Vaccination Coverage (% of HIT)"),
xx = rep(c(0.17, 0.49, 0.81), 7),
xy = rep(seq(0.8372, 0.01, by = -0.1317), each = 3))
gg <- ggplot(output_data, aes(x = xaxis, y = SLpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = evppi_fits,
aes(ymin = lower, ymax = upper, fill = strategy, alpha = ceiling(alpha)*(0.05+0.45*(res > 0.25))),
color = NA) +
geom_point(shape = 19, size = 0.02, stroke = 0.2) +
geom_line(data = evppi_fits, linewidth = 0.5) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0, 1)) +
theme_bw() +
facetted_pos_scales(
x = list(
location == "LLMIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(1,300),breaks=c(1,3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(3,300),breaks=c(3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(10,1000),breaks=c(10,30,100,300,1000),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-3,3),breaks=seq(-3,3,by=1.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Influenza-1918-X" ~ scale_x_log10(limits=c(1,300),breaks=c(1,3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-1918-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-1918-X" ~ scale_x_continuous(limits=c(50,200),breaks=seq(50,200,by=50),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Omicron-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Omicron-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Omicron-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Delta-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Delta-X" ~ scale_x_log10(limits=c(1e-3,1e-1),breaks=c(1e-3,3e-3,1e-2,3e-2,1e-1),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Delta-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Wildtype-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Wildtype-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Wildtype-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "SARS-X" ~ scale_x_continuous(limits=c(0,250),breaks=seq(0,250,by=50),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "SARS-X" ~ scale_x_log10(limits=c(1,100),breaks=c(1,3,10,30,100),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "SARS-X" ~ scale_x_continuous(limits=c(4,14),breaks=seq(4,14,by=2),expand=c(0,0),position="bottom")),
y = list(
location == "LLMIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"))) +
theme(panel.spacing = unit(0.75, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
guides(color = guide_legend(title = NULL, override.aes = list(linewidth = 1.5)), fill = "none", alpha = "none") +
theme(legend.position = "bottom", legend.box.just = "right",
legend.key.size = unit(0.8, "cm"), legend.text = element_text(size = 9),
legend.margin = margin(0, 0, 0, 0))
gg <- ggdraw(gg) + draw_text(evppi_labs$xlabel, x = evppi_labs$xx, y = evppi_labs$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_S9.png", plot = gg, height = 14, width = 10)
output_data  <- output_data %>%
filter(!(location == "LLMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "UMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "UMIC" & disease == "Influenza-1918-X" & strategy == "No Closures") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "School Closures") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "Elimination") &
!(location == "HIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "HIC" & disease == "Covid-Delta-X" & strategy == "School Closures") &
!(location == "HIC" & disease == "Covid-Delta-X" & strategy == "Economic Closures"))
#                        !(location == "HIC" & disease == "Covid-Wildtype-X" & strategy == "No Closures"))
evppi_fits   <- evppi_fits %>%
filter(!(location == "LLMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "UMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "UMIC" & disease == "Influenza-1918-X" & strategy == "No Closures") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "School Closures") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "Elimination") &
!(location == "HIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "HIC" & disease == "Covid-Delta-X" & strategy == "School Closures") &
!(location == "HIC" & disease == "Covid-Delta-X" & strategy == "Economic Closures"))
#                        !(location == "HIC" & disease == "Covid-Wildtype-X" & strategy == "No Closures"))
evppi_labs   <- evppi_fits %>%
group_by(disease, location) %>%
summarize(xlabel = unique(parameter), .groups = "drop") %>% #may vary by income group(@)
mutate(xlabel = case_when(xlabel == "mean_age" ~ "Average Age (years)",
#xlabel == "pr_le" ~ "@ Life Expectancy (years)",
#xlabel == "AL_wavg" ~ "Household Contacts (#/person/day)",
#xlabel == "AHT_wavg" ~ "Other-Location Contacts (#/person/day)",
xlabel == "AS_wavg" ~ "School Contacts (#/child/day)",
#xlabel == "workp" ~ "Workplace Contacts (#/adult/day)",
#xlabel == "epop" ~ "Employment-Population Ratio (%)",
#xlabel == "pr_workf" ~ "@ Sector Workforce (%)",
xlabel == "pr_gvapw" ~ "GVA per Worker ($)",
#xlabel == "pr_wfh" ~ "@ Home-Working Ratio (%)",
xlabel == "Tres" ~ "Response Time (doubling times)",
xlabel == "sda" ~ "Distancing Multiplier Intercept",
xlabel == "sdb" ~ "Distancing Death-Sensitivity",
xlabel == "sdc" ~ "Distancing Time-Decay",
xlabel == "t_tit" ~ "Testing Start-Time (doubling times)",
xlabel == "trate" ~ "Testing Rate (per 100k/day)",
xlabel == "Hmax" ~ "Spare Hospital Beds (per 100k)",
xlabel == "t_vax" ~ "Vaccination Start-Time (days)",
#xlabel == "arate" ~ "Vaccination Rate (per 100k/day)",
xlabel == "puptake" ~ "Vaccination Coverage (% of HIT)"),
xx = rep(c(0.17, 0.49, 0.81), 7),
xy = rep(seq(0.8372, 0.01, by = -0.1317), each = 3))
gg <- ggplot(output_data, aes(x = xaxis, y = SLpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = evppi_fits,
aes(ymin = lower, ymax = upper, fill = strategy, alpha = ceiling(alpha)*(0.05+0.45*(res > 0.25))),
color = NA) +
geom_point(shape = 19, size = 0.02, stroke = 0.2) +
geom_line(data = evppi_fits, linewidth = 0.5) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0, 1)) +
theme_bw() +
facetted_pos_scales(
x = list(
location == "LLMIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(1,300),breaks=c(1,3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(3,300),breaks=c(3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(10,1000),breaks=c(10,30,100,300,1000),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-3,3),breaks=seq(-3,3,by=1.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Influenza-1918-X" ~ scale_x_log10(limits=c(1,300),breaks=c(1,3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-1918-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-1918-X" ~ scale_x_continuous(limits=c(50,200),breaks=seq(50,200,by=50),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Omicron-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Omicron-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Omicron-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Delta-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Delta-X" ~ scale_x_log10(limits=c(1e-3,1e-1),breaks=c(1e-3,3e-3,1e-2,3e-2,1e-1),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Delta-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Wildtype-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Wildtype-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Wildtype-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "SARS-X" ~ scale_x_continuous(limits=c(0,250),breaks=seq(0,250,by=50),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "SARS-X" ~ scale_x_log10(limits=c(1,100),breaks=c(1,3,10,30,100),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "SARS-X" ~ scale_x_continuous(limits=c(4,14),breaks=seq(4,14,by=2),expand=c(0,0),position="bottom")),
y = list(
location == "LLMIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"))) +
theme(panel.spacing = unit(0.75, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
guides(color = guide_legend(title = NULL, override.aes = list(linewidth = 1.5)), fill = "none", alpha = "none") +
theme(legend.position = "bottom", legend.box.just = "right",
legend.key.size = unit(0.8, "cm"), legend.text = element_text(size = 9),
legend.margin = margin(0, 0, 0, 0))
gg <- ggdraw(gg) + draw_text(evppi_labs$xlabel, x = evppi_labs$xx, y = evppi_labs$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_S9.png", plot = gg, height = 14, width = 10)
output_data  <- output_data %>%
filter(!(location == "LLMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "LLMIC" & disease == "Covid-Omicron-X" & strategy == "Elimination") &
!(location == "LLMIC" & disease == "Covid-Delta-X" & strategy == "Elimination") &
!(location == "UMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "UMIC" & disease == "Influenza-1918-X" & strategy == "No Closures") &
!(location == "UMIC" & disease == "Covid-Omicron-X" & strategy == "Elimination") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "School Closures") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "Elimination") &
!(location == "HIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "HIC" & disease == "Covid-Delta-X" & strategy == "School Closures") &
!(location == "HIC" & disease == "Covid-Delta-X" & strategy == "Economic Closures"))
evppi_fits   <- evppi_fits %>%
filter(!(location == "LLMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "LLMIC" & disease == "Covid-Omicron-X" & strategy == "Elimination") &
!(location == "LLMIC" & disease == "Covid-Delta-X" & strategy == "Elimination") &
!(location == "UMIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "UMIC" & disease == "Influenza-1918-X" & strategy == "No Closures") &
!(location == "UMIC" & disease == "Covid-Omicron-X" & strategy == "Elimination") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "School Closures") &
!(location == "UMIC" & disease == "SARS-X" & strategy == "Elimination") &
!(location == "HIC" & disease == "Influenza-2009-X" & strategy == "Economic Closures") &
!(location == "HIC" & disease == "Covid-Delta-X" & strategy == "School Closures") &
!(location == "HIC" & disease == "Covid-Delta-X" & strategy == "Economic Closures"))
evppi_labs   <- evppi_fits %>%
group_by(disease, location) %>%
summarize(xlabel = unique(parameter), .groups = "drop") %>% #may vary by income group(@)
mutate(xlabel = case_when(xlabel == "mean_age" ~ "Average Age (years)",
#xlabel == "pr_le" ~ "@ Life Expectancy (years)",
#xlabel == "AL_wavg" ~ "Household Contacts (#/person/day)",
#xlabel == "AHT_wavg" ~ "Other-Location Contacts (#/person/day)",
xlabel == "AS_wavg" ~ "School Contacts (#/child/day)",
#xlabel == "workp" ~ "Workplace Contacts (#/adult/day)",
#xlabel == "epop" ~ "Employment-Population Ratio (%)",
#xlabel == "pr_workf" ~ "@ Sector Workforce (%)",
xlabel == "pr_gvapw" ~ "GVA per Worker ($)",
#xlabel == "pr_wfh" ~ "@ Home-Working Ratio (%)",
xlabel == "Tres" ~ "Response Time (doubling times)",
xlabel == "sda" ~ "Distancing Multiplier Intercept",
xlabel == "sdb" ~ "Distancing Death-Sensitivity",
xlabel == "sdc" ~ "Distancing Time-Decay",
xlabel == "t_tit" ~ "Testing Start-Time (doubling times)",
xlabel == "trate" ~ "Testing Rate (per 100k/day)",
xlabel == "Hmax" ~ "Spare Hospital Beds (per 100k)",
xlabel == "t_vax" ~ "Vaccination Start-Time (days)",
#xlabel == "arate" ~ "Vaccination Rate (per 100k/day)",
xlabel == "puptake" ~ "Vaccination Coverage (% of HIT)"),
xx = rep(c(0.17, 0.49, 0.81), 7),
xy = rep(seq(0.8372, 0.01, by = -0.1317), each = 3))
gg <- ggplot(output_data, aes(x = xaxis, y = SLpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = evppi_fits,
aes(ymin = lower, ymax = upper, fill = strategy, alpha = ceiling(alpha)*(0.05+0.45*(res > 0.25))),
color = NA) +
geom_point(shape = 19, size = 0.02, stroke = 0.2) +
geom_line(data = evppi_fits, linewidth = 0.5) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0, 1)) +
theme_bw() +
facetted_pos_scales(
x = list(
location == "LLMIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(1,300),breaks=c(1,3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(3,300),breaks=c(3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(10,1000),breaks=c(10,30,100,300,1000),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-3,3),breaks=seq(-3,3,by=1.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Influenza-1918-X" ~ scale_x_log10(limits=c(1,300),breaks=c(1,3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-1918-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-1918-X" ~ scale_x_continuous(limits=c(50,200),breaks=seq(50,200,by=50),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Omicron-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Omicron-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Omicron-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Delta-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Delta-X" ~ scale_x_log10(limits=c(1e-3,1e-1),breaks=c(1e-3,3e-3,1e-2,3e-2,1e-1),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Delta-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Wildtype-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Wildtype-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Wildtype-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "SARS-X" ~ scale_x_continuous(limits=c(0,250),breaks=seq(0,250,by=50),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "SARS-X" ~ scale_x_log10(limits=c(1,100),breaks=c(1,3,10,30,100),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "SARS-X" ~ scale_x_continuous(limits=c(4,14),breaks=seq(4,14,by=2),expand=c(0,0),position="bottom")),
y = list(
location == "LLMIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"))) +
theme(panel.spacing = unit(0.75, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
guides(color = guide_legend(title = NULL, override.aes = list(linewidth = 1.5)), fill = "none", alpha = "none") +
theme(legend.position = "bottom", legend.box.just = "right",
legend.key.size = unit(0.8, "cm"), legend.text = element_text(size = 9),
legend.margin = margin(0, 0, 0, 0))
gg <- ggdraw(gg) + draw_text(evppi_labs$xlabel, x = evppi_labs$xx, y = evppi_labs$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_S9.png", plot = gg, height = 14, width = 10)
gg <- ggplot(output_data, aes(x = xaxis, y = SLpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = evppi_fits,
aes(ymin = lower, ymax = upper, fill = strategy, alpha = ceiling(alpha)*(0.05+0.45*(res > 0.25))),
color = NA) +
geom_point(shape = 19, size = 0.02, stroke = 0.2) +
geom_line(data = evppi_fits, linewidth = 0.5) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0, 1)) +
theme_bw() +
facetted_pos_scales(
x = list(
location == "LLMIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(1,300),breaks=c(1,3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(3,300),breaks=c(3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-2009-X" ~ scale_x_log10(limits=c(10,1000),breaks=c(10,30,100,300,1000),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-1957-X" ~ scale_x_continuous(limits=c(-3,3),breaks=seq(-3,3,by=1.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Influenza-1918-X" ~ scale_x_log10(limits=c(1,300),breaks=c(1,3,10,30,100,300),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Influenza-1918-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Influenza-1918-X" ~ scale_x_continuous(limits=c(50,200),breaks=seq(50,200,by=50),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Omicron-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Omicron-X" ~ scale_x_continuous(limits=c(-5,5),breaks=seq(-5,5,by=2.5),labels=scales::label_parse(),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Omicron-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Delta-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Delta-X" ~ scale_x_log10(limits=c(1e-3,1e-1),breaks=c(1e-3,3e-3,1e-2,3e-2,1e-1),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Delta-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "Covid-Wildtype-X" ~ scale_x_continuous(limits=c(-4,4),breaks=seq(-4,4,by=2),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "Covid-Wildtype-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "Covid-Wildtype-X" ~ scale_x_log10(limits=c(1e-3,1e+1),breaks=c(1e-3,1e-2,1e-1,1e+0,1e+1),labels = scales::trans_format("log10", scales::math_format(10^.x)),expand=c(0,0),position="bottom"),
location == "LLMIC" & disease == "SARS-X" ~ scale_x_continuous(limits=c(0,250),breaks=seq(0,250,by=50),expand=c(0,0),position="bottom"),
location == "UMIC" & disease == "SARS-X" ~ scale_x_log10(limits=c(1,100),breaks=c(1,3,10,30,100),expand=c(0,0),position="bottom"),
location == "HIC" & disease == "SARS-X" ~ scale_x_continuous(limits=c(4,14),breaks=seq(4,14,by=2),expand=c(0,0),position="bottom")),
y = list(
location == "LLMIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-2009-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-1957-X" ~ scale_y_log10(limits=c(0.3,300),breaks=3*10^seq(-1,2),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Influenza-1918-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Omicron-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Delta-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "Covid-Wildtype-X" ~ scale_y_log10(limits=c(10,300),breaks=c(10,30,100,300),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "LLMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(100,3000),breaks=c(100,300,1000,3000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "UMIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"),
location == "HIC" & disease == "SARS-X" ~ scale_y_log10(limits=c(30,1000),breaks=c(30,100,300,1000),labels=scales::label_parse(),expand=c(0,0),position="right"))) +
theme(panel.spacing = unit(0.75, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
guides(color = guide_legend(title = NULL, override.aes = list(linewidth = 1.5)), fill = "none", alpha = "none") +
theme(legend.position = "bottom", legend.box.just = "right",
legend.key.size = unit(0.8, "cm"), legend.text = element_text(size = 9),
legend.margin = margin(0, 0, 0, 0))
gg <- ggdraw(gg) + draw_text(evppi_labs$xlabel, x = evppi_labs$xx, y = evppi_labs$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_S9.png", plot = gg, height = 14, width = 10)
rm(list=ls())
