theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
#      guides(shape = "none", color = guide_legend(title = NULL), fill = "none", alpha = "none") +
guides(shape = "none", color = "none", fill = "none", alpha = "none") +
theme(legend.position = c(0.141, 0.959), legend.justification = c(1, 1), legend.box.just = "right",
legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_6.png", plot = gg, height = 14, width = 10)
gg <- ggplot(data = arch_data, aes(x = xaxis, y = SECpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = arch_fit %>% filter(alpha == 1), aes(ymin = lower, ymax = upper, fill = strategy, group = interaction(group, strategy)), color = NA, alpha = 0.1) +
#geom_point(shape = 21, size = 0.1, stroke = 0.35, fill = NA) +
geom_line(data = arch_fit, aes(x = xaxis, y = SECpc, color = strategy), linewidth = 0.75) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0.05, 1)) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
#      guides(shape = "none", color = guide_legend(title = NULL), fill = "none", alpha = "none") +
guides(shape = "none", color = "none", fill = "none", alpha = "none") +
theme(legend.position = c(0.141, 0.959), legend.justification = c(1, 1), legend.box.just = "right",
legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_6.png", plot = gg, height = 14, width = 10)
gg <- ggplot(data = arch_data, aes(x = xaxis, y = SECpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = arch_fit %>% filter(alpha == 1), aes(ymin = lower, ymax = upper, fill = strategy, group = interaction(group, strategy)), color = NA, alpha = 0.1) +
#geom_point(shape = 21, size = 0.1, stroke = 0.35, fill = NA) +
#geom_line(data = arch_fit, aes(x = xaxis, y = SECpc, color = strategy), linewidth = 0.75) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0.05, 1)) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
#      guides(shape = "none", color = guide_legend(title = NULL), fill = "none", alpha = "none") +
guides(shape = "none", color = "none", fill = "none", alpha = "none") +
theme(legend.position = c(0.141, 0.959), legend.justification = c(1, 1), legend.box.just = "right",
legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_6.png", plot = gg, height = 14, width = 10)
gg <- ggplot(data = arch_data, aes(x = xaxis, y = SECpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = arch_fit %>% filter(alpha == 1), aes(ymin = lower, ymax = upper, fill = strategy, group = interaction(group, strategy)), color = NA, alpha = 0.1) +
geom_point(shape = 21, size = 0.1, stroke = 0.35, fill = NA) +
#geom_line(data = arch_fit, aes(x = xaxis, y = SECpc, color = strategy), linewidth = 0.75) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0.05, 1)) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
#      guides(shape = "none", color = guide_legend(title = NULL), fill = "none", alpha = "none") +
guides(shape = "none", color = "none", fill = "none", alpha = "none") +
theme(legend.position = c(0.141, 0.959), legend.justification = c(1, 1), legend.box.just = "right",
legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_6.png", plot = gg, height = 14, width = 10)
arch_data <- arch_data %>% group_by(location, disease, strategy, xaxis) %>%
mutate(alpha = {x <- xaxis
l <- location
d <- disease
s <- strategy
arch_fit %>% filter(location == l, disease == d, strategy == s) %>%
slice(which.min(abs(xaxis - x))) %>% pull(alpha)}) %>%
ungroup()
rm(list=ls())
graphics.off()
library(dplyr)
library(purrr)
library(tidyr)
library(stringr)
sapply(list.files(path = "functions/voi-master/R/", pattern = "\\.R$", full.names = TRUE), source)
library(ggplot2)
library(ggh4x)
library(cowplot)
source("functions/add_scenario_cols.R")
source("functions/order_scenario_cols.R")
source("functions/calc_cost_pc.R")
source("functions/find_best_strats.R")
source("functions/calc_cost_bdown.R")
source("functions/parse_inputs.R")
source("functions/voi_est.R")
source("functions/voi_est_fit.R")
source("functions/voi_dec.R")
file_list <- list.files(path = "../output/archetypes/", pattern = "\\.csv$", full.names = TRUE)
arch_data <- lapply(file_list, add_scenario_cols) %>% bind_rows() %>% order_scenario_cols() %>%
calc_cost_pc() %>% parse_inputs()
arch_voi  <- voi_dec(arch_data, combn(c("mean_age", "sd_age", "skew_age", "le", "comm", "IGHC", "schoolA2", "workp", "EPOP", "TES",
"gvapw", "wfh", "Tres", "t_tit", "trate", "sdb", "sdl", "Hmax", "t_vax", "arate", "puptake"),
1, simplify = FALSE)) %>%
group_by(location, disease) %>% slice_max(order_by = res, n = 1) %>% ungroup()
arch_data <- arch_data %>% left_join(arch_voi, by = c("location", "disease")) %>%
rowwise() %>% mutate(xaxis = get(parameter)) %>% ungroup()
arch_fit  <- voi_est_fit(arch_data) %>% mutate(l = pmax(0,l)) %>% rename(xaxis = x, SECpc = y, lower = l, upper = u) %>%
group_by(location, disease, xaxis) %>% mutate(alpha = ifelse(SECpc == min(SECpc), 1, 0)) %>% ungroup() %>%
mutate(group = cumsum(alpha == 0 | lag(alpha == 0, default = FALSE)))
#mutate(alpha = ifelse(lower > upper[which.min(SECpc)], 0.2, 1))
#mutate(min_lower = min(lower), min_upper = upper[which(lower == min_lower)][1],
#alpha = ifelse(lower <= min_upper & upper >= min_lower, 1, 0 ))
arch_data <- arch_data %>% group_by(location, disease, strategy, xaxis) %>%
mutate(alpha = {x <- xaxis
l <- location
d <- disease
s <- strategy
arch_fit %>% filter(location == l, disease == d, strategy == s) %>%
slice(which.min(abs(xaxis - x))) %>% pull(alpha)}) %>% ungroup()
arch_lab  <- arch_fit %>% group_by(disease, location) %>%
summarize(xlabel = unique(parameter), .groups = 'drop') %>%
mutate(xlabel = case_when(xlabel == "mean_age" ~ "Mean Age (years)",
xlabel == "sd_age" ~ "SD Age (years)",
xlabel == "skew_age" ~ "Skewness Age",
xlabel == "le" ~ "Life Expectancy (years)",
xlabel == "comm" ~ "Mean Household Contacts (per person/day)",
xlabel == "IGHC" ~ "Inter-Generation Household Contacts (%)",
xlabel == "schoolA2" ~ "Mean School Contacts (per person/day)",
xlabel == "workp" ~ "Mean Workplace Contacts (per person/day)",
xlabel == "EPOP" ~ "Employment-Population Ratio (%)",
xlabel == "TES" ~ "Teritary Sector Employment (%)",
xlabel == "gvapw" ~ "GVA per Worker ($m)",
xlabel == "wfh" ~ "Home-Working Ratio (%)",
xlabel == "Tres" ~ "Response Time (day)",
xlabel == "t_tit" ~ "Testing Start-Time (day)",
xlabel == "trate" ~ "Testing Rate (per 100k/day)",
xlabel == "sdb" ~ "Distancing Sensitivity",
xlabel == "sdl" ~ "Distancing Maximum",
xlabel == "Hmax" ~ "Hospital Capacity (per 100k)",
xlabel == "t_vax" ~ "Vaccination Start-Time (day)",
xlabel == "arate" ~ "Vaccination Rate (per 100k/day)",
xlabel == "puptake" ~ "Vaccination Coverage (%)"),
xx = rep(c(0.16, 0.49, 0.81), 7),
xy = rep(seq(0.838, 0, by = -0.1375), each = 3))
gg <- ggplot(data = arch_data, aes(x = xaxis, y = SECpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = arch_fit %>% filter(alpha == 1),
aes(ymin = lower, ymax = upper, fill = strategy, group = interaction(group, strategy)), color = NA, alpha = 0.1) +
geom_point(shape = 21, size = 0.1, stroke = 0.35, fill = NA) +
geom_line(data = arch_fit, aes(x = xaxis, y = SECpc, color = strategy), linewidth = 0.75) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0, 1)) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
#      guides(shape = "none", color = guide_legend(title = NULL), fill = "none", alpha = "none") +
guides(shape = "none", color = "none", fill = "none", alpha = "none") +
theme(legend.position = c(0.141, 0.959), legend.justification = c(1, 1), legend.box.just = "right",
legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_6.png", plot = gg, height = 14, width = 10)
any(arch_data$SECpc<0)
any(arch_fit$SECpc<0)
any(arch_fit$upper<0)
any(arch_fit$lower<0)
gg <- ggplot(data = arch_data, aes(x = xaxis, y = SECpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = arch_fit %>% filter(alpha == 1),
aes(ymin = lower, ymax = upper, fill = strategy, group = interaction(group, strategy)), color = NA, alpha = 0.1) +
geom_point(shape = 21, size = 0.1, stroke = 0.35, fill = NA) +
geom_line(data = arch_fit, aes(x = xaxis, y = SECpc), linewidth = 0.75) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0, 1)) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
#      guides(shape = "none", color = guide_legend(title = NULL), fill = "none", alpha = "none") +
guides(shape = "none", color = "none", fill = "none", alpha = "none") +
theme(legend.position = c(0.141, 0.959), legend.justification = c(1, 1), legend.box.just = "right",
legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_6.png", plot = gg, height = 14, width = 10)
gg <- ggplot(data = arch_data, aes(x = xaxis, y = SECpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = arch_fit %>% filter(alpha == 1),
aes(ymin = lower, ymax = upper, fill = strategy, group = interaction(group, strategy)), color = NA, alpha = 0.1) +
geom_point(shape = 21, size = 0.1, stroke = 0.35, fill = NA) +
geom_line(data = arch_fit, linewidth = 0.75) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0, 1)) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
#      guides(shape = "none", color = guide_legend(title = NULL), fill = "none", alpha = "none") +
guides(shape = "none", color = "none", fill = "none", alpha = "none") +
theme(legend.position = c(0.141, 0.959), legend.justification = c(1, 1), legend.box.just = "right",
legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_6.png", plot = gg, height = 14, width = 10)
gg <- ggplot(data = arch_data, aes(x = xaxis, y = SECpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = arch_fit %>% filter(alpha == 1),
aes(ymin = lower, ymax = upper, fill = strategy, group = interaction(group, strategy)), color = NA, alpha = 0.2) +
geom_point(shape = 21, size = 0.1, stroke = 0.35, fill = NA) +
geom_line(data = arch_fit, linewidth = 0.75) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0, 1)) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
guides(color = guide_legend(title = NULL), fill = "none", alpha = "none") +
theme(legend.position = c(0.141, 0.959), legend.justification = c(1, 1), legend.box.just = "right",
legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_6.png", plot = gg, height = 14, width = 10)
gg <- ggplot(data = arch_data, aes(x = xaxis, y = SECpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = arch_fit %>% filter(alpha == 1),
aes(ymin = lower, ymax = upper, fill = strategy, group = interaction(group, strategy)), color = NA, alpha = 0.2) +
geom_point(shape = 21, size = 0.1, stroke = 0.35, fill = NA) +
geom_line(data = arch_fit, linewidth = 0.75) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0, 1)) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_continuous(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
guides(color = guide_legend(title = NULL), fill = "none", alpha = "none") +
theme(legend.position = c(0.141, 0.959), legend.justification = c(1, 1), legend.box.just = "right",
legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_6t.png", plot = gg, height = 14, width = 10)
gg <- ggplot(data = arch_data, aes(x = xaxis, y = SECpc, color = strategy, alpha = alpha)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_ribbon(data = arch_fit %>% filter(alpha == 1),
aes(ymin = lower, ymax = upper, fill = strategy, group = interaction(group, strategy)), color = NA, alpha = 0.2) +
geom_point(shape = 21, size = 0.1, stroke = 0.35, fill = NA) +
geom_line(data = arch_fit, linewidth = 0.75) +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
scale_alpha(range = c(0, 1)) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_continuous(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "Societal Loss (% of GDP)") +
guides(color = guide_legend(title = NULL), fill = "none", alpha = "none") +
theme(legend.position = c(0.141, 0.959), legend.justification = c(1, 1), legend.box.just = "right",
legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_6.png", plot = gg, height = 14, width = 10)
graphics.off()
rm(list=ls())
library(dplyr)
library(purrr)
library(tidyr)
library(stringr)
sapply(list.files(path = "functions/voi-master/R/", pattern = "\\.R$", full.names = TRUE), source)
library(ggplot2)
library(ggh4x)
library(cowplot)
source("functions/add_scenario_cols.R")
source("functions/order_scenario_cols.R")
source("functions/calc_cost_pc.R")
source("functions/find_best_strats.R")
source("functions/calc_cost_bdown.R")
source("functions/parse_inputs.R")
source("functions/voi_est.R")
source("functions/voi_est_fit.R")
source("functions/voi_dec.R")
file_list <- list.files(path = "../output/archetypes/", pattern = "\\.csv$", full.names = TRUE)
arch_data <- lapply(file_list, add_scenario_cols) %>% bind_rows() %>% order_scenario_cols() %>%
calc_cost_pc() %>% parse_inputs()
arch_voi  <- voi_dec(arch_data, combn(c("mean_age", "sd_age", "skew_age", "le", "comm", "IGHC", "schoolA2", "workp", "EPOP", "TES",
"gvapw", "wfh", "Tres", "t_tit", "trate", "sdb", "sdl", "Hmax", "t_vax", "arate", "puptake"),
2, simplify = FALSE)) %>%
group_by(location, disease) %>% slice_max(order_by = res, n = 1) %>% ungroup() #%>%
#mutate(param1    = str_split(parameter, ",", simplify = TRUE)[, 1],
#       param2    = str_split(parameter, ",", simplify = TRUE)[, 2],
#       parameter = case_when(row_number() %in% c(1,2,5,6,8,9,10,11,12,13,16,18,21) ~ paste(param2, param1, sep = ","),
#                             TRUE ~ parameter)) %>%
#select(-param1,-param2)
names(arch_data)
names(arch_voi)
arch_voi
#mutate(param1    = str_split(parameter, ",", simplify = TRUE)[, 1],
#       param2    = str_split(parameter, ",", simplify = TRUE)[, 2],
#       parameter = case_when(row_number() %in% c(1,2,5,6,8,9,10,11,12,13,16,18,21) ~ paste(param2, param1, sep = ","),
#                             TRUE ~ parameter)) %>%
#select(-param1,-param2)
arch_data <- arch_data %>% left_join(arch_voi, by = c("location", "disease"))
arch_data %>% filter(location == "LLMIC" & disease == "Influenza-2009-X") %>% select(res)
arch_voi
arch_data %>% filter(location == "LLMIC" & disease == "Influenza-2009-X") %>% select(parameter)
arch_data %>% filter(location == "LLMIC" & disease == "Influenza-2009-X") %>% select(parameter) %>% unique()
arch_fit  <- voi_est_fit(arch_data) %>% rename(xaxis = x, yaxis = y, SECpc = z)
arch_lab  <- arch_fit %>% group_by(disease, location) %>%
summarize(xlabel = str_split(unique(parameter), ",", simplify = TRUE)[, 1],
ylabel = str_split(unique(parameter), ",", simplify = TRUE)[, 2], .groups = 'drop') %>%
mutate(across(c(xlabel, ylabel), ~ case_when(. == "mean_age" ~ "Mean Age (years)",
. == "sd_age" ~ "SD Age (years)",
. == "skew_age" ~ "Skewness Age",
. == "le" ~ "Life Expectancy (years)",
. == "comm" ~ "Mean Household Contacts (per person/day)",
. == "IGHC" ~ "Inter-Generation Household Contacts (%)",
. == "schoolA2" ~ "Mean School Contacts (per person/day)",
. == "workp" ~ "Mean Workplace Contacts (per person/day)",
. == "EPOP" ~ "Employment-Population Ratio (%)",
. == "TES" ~ "Teritary Sector Employment (%)",
. == "gvapw" ~ "GVA per Worker ($m)",
. == "wfh" ~ "Home-Working Ratio (%)",
. == "Tres" ~ "Response Time (day)",
. == "t_tit" ~ "Testing Start-Time (day)",
. == "trate" ~ "Testing Rate (per 100k/day)",
. == "sdb" ~ "Distancing Sensitivity",
. == "sdl" ~ "Distancing Maximum",
. == "Hmax" ~ "Hospital Capacity (per 100k)",
. == "t_vax" ~ "Vaccination Start-Time (day)",
. == "arate" ~ "Vaccination Rate (per 100k/day)",
. == "puptake" ~ "Vaccination Coverage (%)")),
xx = rep(c(0.16, 0.49, 0.82), 7),
xy = rep(seq(0.838, 0, by = -0.1375), each = 3),
yx = rep(c(0.325, 0.655, 0.985), 7),
yy = rep(seq(0.900, 0, by = -0.1375), each = 3))
gg <- ggplot(arch_fit, aes(x = xaxis, y = yaxis, z = SECpc, color = strategy)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_contour_filled() +
scale_color_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod"))
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "") +
guides(color = guide_colorbar(barwidth = 1, barheight = 10)) +
theme(legend.position = "right")
gg <- ggplot(arch_fit, aes(x = xaxis, y = yaxis, z = SECpc, color = strategy)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_contour_filled()
ggsave("figure_7.png", plot = gg, height = 14, width = 10)
gg <- ggplot(arch_fit, aes(x = xaxis, y = yaxis, z = SECpc, fill = strategy)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_contour_filled()
gg <- ggplot(arch_fit, aes(x = xaxis, y = yaxis, z = SECpc, fill = strategy)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_contour_filled() +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod"))
theme_bw()
gg <- ggplot(arch_fit, aes(x = xaxis, y = yaxis, z = SECpc, fill = strategy)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_contour_filled() +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
theme_bw()
ggsave("figure_7.png", plot = gg, height = 14, width = 10)
gg <- ggplot(arch_fit, aes(x = xaxis, y = yaxis, z = SECpc, fill = strategy)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_contour_filled() +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right")
gg <- ggplot(arch_fit, aes(x = xaxis, y = yaxis, z = SECpc, fill = strategy)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_contour_filled() +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "") +
guides(color = guide_colorbar(barwidth = 1, barheight = 10)) +
theme(legend.position = "right")
#      legend.position = c(0.29, 0.999), legend.justification = c(1, 1), legend.box.just = "right",
#      legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9) +
draw_text(arch_lab$ylabel, angle = 90, x = arch_lab$yx, y = arch_lab$yy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_7.png", plot = gg, height = 14, width = 10)
gg <- ggplot(arch_fit, aes(x = xaxis, y = yaxis, z = SECpc, fill = strategy)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_contour_filled() +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "") +
guides(fill = "none") +
theme(legend.position = "right")
#      legend.position = c(0.29, 0.999), legend.justification = c(1, 1), legend.box.just = "right",
#      legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9) +
draw_text(arch_lab$ylabel, angle = 90, x = arch_lab$yx, y = arch_lab$yy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_7.png", plot = gg, height = 14, width = 10)
gg <- ggplot(arch_fit, aes(x = xaxis, y = yaxis, z = -SECpc, fill = strategy)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_contour_filled() +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "") +
guides(fill = "none") +
theme(legend.position = "right")
#      legend.position = c(0.29, 0.999), legend.justification = c(1, 1), legend.box.just = "right",
#      legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9) +
draw_text(arch_lab$ylabel, angle = 90, x = arch_lab$yx, y = arch_lab$yy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_7.png", plot = gg, height = 14, width = 10)
names(arch_fit)
arch_fit
arch_fit  <- voi_est_fit(arch_data) %>% rename(xaxis = x, yaxis = y, SECpc = z) %>%
group_by(location, disease, xaxis, yaxis) %>%
mutate(SECpc = ifelse(SECpc == min(SECpc, na.rm = TRUE), SECpc, NA)) %>%
ungroup()
arch_lab  <- arch_fit %>% group_by(disease, location) %>%
summarize(xlabel = str_split(unique(parameter), ",", simplify = TRUE)[, 1],
ylabel = str_split(unique(parameter), ",", simplify = TRUE)[, 2], .groups = 'drop') %>%
mutate(across(c(xlabel, ylabel), ~ case_when(. == "mean_age" ~ "Mean Age (years)",
. == "sd_age" ~ "SD Age (years)",
. == "skew_age" ~ "Skewness Age",
. == "le" ~ "Life Expectancy (years)",
. == "comm" ~ "Mean Household Contacts (per person/day)",
. == "IGHC" ~ "Inter-Generation Household Contacts (%)",
. == "schoolA2" ~ "Mean School Contacts (per person/day)",
. == "workp" ~ "Mean Workplace Contacts (per person/day)",
. == "EPOP" ~ "Employment-Population Ratio (%)",
. == "TES" ~ "Teritary Sector Employment (%)",
. == "gvapw" ~ "GVA per Worker ($m)",
. == "wfh" ~ "Home-Working Ratio (%)",
. == "Tres" ~ "Response Time (day)",
. == "t_tit" ~ "Testing Start-Time (day)",
. == "trate" ~ "Testing Rate (per 100k/day)",
. == "sdb" ~ "Distancing Sensitivity",
. == "sdl" ~ "Distancing Maximum",
. == "Hmax" ~ "Hospital Capacity (per 100k)",
. == "t_vax" ~ "Vaccination Start-Time (day)",
. == "arate" ~ "Vaccination Rate (per 100k/day)",
. == "puptake" ~ "Vaccination Coverage (%)")),
xx = rep(c(0.16, 0.49, 0.82), 7),
xy = rep(seq(0.838, 0, by = -0.1375), each = 3),
yx = rep(c(0.325, 0.655, 0.985), 7),
yy = rep(seq(0.900, 0, by = -0.1375), each = 3))
gg <- ggplot(arch_fit, aes(x = xaxis, y = yaxis, z = SECpc, fill = strategy)) +
facet_grid2(disease ~ location, switch = "y", scales = "free", independent = "all") +
geom_contour_filled() +
scale_fill_manual(values = c("No Closures" = "magenta4", "School Closures" = "navy",
"Economic Closures" = "darkgreen", "Elimination" = "goldenrod")) +
theme_bw() +
scale_x_log10(expand = c(0, 0), position = "bottom") +
scale_y_log10(expand = c(0, 0), position = "right") +
#facetted_pos_scales(x = list(disease == "Covid-Omicron-X" & location == "HIC" ~ scale_x_continuous(labels = "Hospital Capacity"))) +
theme(panel.spacing = unit(1.25, "lines")) +
labs(title = "", x = "", y = "") +
guides(fill = "none") +
theme(legend.position = "right")
#      legend.position = c(0.29, 0.999), legend.justification = c(1, 1), legend.box.just = "right",
#      legend.key.size = unit(0.5, "cm"), legend.text = element_text(size = 7))
gg <- ggdraw(gg) + draw_text(arch_lab$xlabel, x = arch_lab$xx, y = arch_lab$xy, hjust = 0.5, vjust = 0.5, size = 9) +
draw_text(arch_lab$ylabel, angle = 90, x = arch_lab$yx, y = arch_lab$yy, hjust = 0.5, vjust = 0.5, size = 9)
ggsave("figure_7.png", plot = gg, height = 14, width = 10)
arch_fit  <- voi_est_fit(arch_data) %>% rename(xaxis = x, yaxis = y, SECpc = z)
